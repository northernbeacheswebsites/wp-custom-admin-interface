<?php

/*
*		Plugin Name: WP Custom Admin Interface
*		Plugin URI: https://www.northernbeacheswebsites.com.au
*		Description: With WP Custom Admin Interface you can easily customise the WordPress admin and login interfaces.  
*		Version: 2.5
*		Author: Martin Gibson
*		Developer: Northern Beaches Websites
*		Developer URI:  https://www.northernbeacheswebsites.com.au
*		Text Domain: wp-custom-admin-interface 
*       Copyright: Â©2017 Northern Beaches Websites.
*		Support: https://www.northernbeacheswebsites.com.au/contact
*		Licence: GNU General Public License v3.0
*       License URI: http://www.gnu.org/licenses/gpl-3.0.html
*/



/**
* 
*
*
* Create admin menu and add it to a global variable so that admin styles/scripts can hook into it
*/
add_action( 'admin_menu', 'wp_custom_admin_interface_add_admin_menu' );
add_action( 'admin_init', 'wp_custom_admin_interface_settings_init' );

function wp_custom_admin_interface_add_admin_menu(  ) { 
    $menu_icon_svg = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMS4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCAyMCAyMCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjAgMjA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJLnN0MHtmaWxsOiNGRkZGRkY7fQ0KCS5zdDF7ZmlsbDojQTBBNUFBO30NCjwvc3R5bGU+DQo8cGF0aCBjbGFzcz0ic3QwIiBkPSJNLTM2OC4xLTE4LjljMC04MS43LDAtMTYzLjMsMC0yNDVjODcuNSwwLDE3NSwwLDI2Mi41LDBjMCw4MS43LDAsMTYzLjMsMCwyNDUNCglDLTE5My4xLTE4LjktMjgwLjYtMTguOS0zNjguMS0xOC45eiBNLTI5MC43LTE5MS45YzYuMiwwLDEyLjUsMCwxOC43LDBjNy4yLDAsMTEuMy00LjEsMTEuMy0xMS4yYzAtMTIuNSwwLTI1LDAtMzcuNQ0KCWMwLTcuMS00LjEtMTEuMi0xMS4xLTExLjJjLTEyLjYsMC0yNS4yLDAtMzcuNywwYy02LjksMC0xMS4xLDQuMS0xMS4xLDExYzAsMTIuNywwLDI1LjMsMCwzOGMwLDYuNyw0LjIsMTAuOSwxMC45LDExDQoJQy0zMDMuNC0xOTEuOS0yOTctMTkxLjktMjkwLjctMTkxLjl6IE0tMTkwLjYtMTcxLjljLTYuMywwLTEyLjcsMC0xOSwwYy02LjksMC0xMSw0LjItMTEsMTEuMWMwLDEyLjYsMCwyNS4yLDAsMzcuNw0KCWMwLDYuOSw0LjEsMTEuMSwxMSwxMS4xYzEyLjcsMCwyNS4zLDAsMzgsMGM2LjgsMCwxMS00LjIsMTEtMTEuMWMwLTEyLjYsMC0yNS4yLDAtMzcuN2MwLTctNC4xLTExLjEtMTEuMi0xMS4xDQoJQy0xNzguMS0xNzEuOS0xODQuMy0xNzEuOS0xOTAuNi0xNzEuOXogTS0yNzAuNi05MS44Yy02LjIsMC0xMi41LDAtMTguNywwYy03LjEsMC0xMS4yLDQuMS0xMS4yLDExLjFjMCwxMi42LDAsMjUuMiwwLDM3LjcNCgljMCw2LjksNC4xLDExLjEsMTEsMTEuMWMxMi43LDAsMjUuMywwLDM4LDBjNi44LDAsMTAuOS00LjIsMTEtMTAuOWMwLTEyLjcsMC0yNS41LDAtMzguMmMwLTYuNi00LjItMTAuOC0xMC44LTEwLjgNCglDLTI1Ny44LTkxLjktMjY0LjItOTEuOC0yNzAuNi05MS44eiBNLTI1NS41LTIxMi4xYzQ1LjEsMCw4OS45LDAsMTM0LjcsMGMwLTYuNiwwLTEzLjEsMC0xOS42Yy00NSwwLTg5LjgsMC0xMzQuNywwDQoJQy0yNTUuNS0yMjUuMS0yNTUuNS0yMTguNy0yNTUuNS0yMTIuMXogTS0zNjAuNC0xNTEuOGMwLDYuOCwwLDEzLjMsMCwxOS43YzQ1LDAsODkuOCwwLDEzNC42LDBjMC02LjcsMC0xMy4yLDAtMTkuNw0KCUMtMjcwLjctMTUxLjgtMzE1LjUtMTUxLjgtMzYwLjQtMTUxLjh6IE0tMjM1LjUtNTIuMWMzOC40LDAsNzYuNiwwLDExNC43LDBjMC02LjcsMC0xMy4xLDAtMTkuNmMtMzguMywwLTc2LjUsMC0xMTQuNywwDQoJQy0yMzUuNS02NS4xLTIzNS41LTU4LjctMjM1LjUtNTIuMXogTS0zMDUuNy03MS43Yy0xOC40LDAtMzYuNiwwLTU0LjcsMGMwLDYuNywwLDEzLjEsMCwxOS42YzE4LjMsMCwzNi41LDAsNTQuNywwDQoJQy0zMDUuNy01OC43LTMwNS43LTY1LjEtMzA1LjctNzEuN3ogTS0zMjUuOC0yMTJjMC02LjcsMC0xMy4zLDAtMTkuN2MtMTEuNywwLTIzLjEsMC0zNC42LDBjMCw2LjcsMCwxMy4yLDAsMTkuNw0KCUMtMzQ4LjgtMjEyLTMzNy40LTIxMi0zMjUuOC0yMTJ6IE0tMTU1LjQtMTUxLjdjMCw2LjcsMCwxMy4xLDAsMTkuN2MxMS42LDAsMjMuMiwwLDM0LjcsMGMwLTYuNiwwLTEzLjEsMC0xOS43DQoJQy0xMzIuMy0xNTEuNy0xNDMuOC0xNTEuNy0xNTUuNC0xNTEuN3oiLz4NCjxnPg0KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik02LDYuMWMtMC41LDAtMSwwLTEuNSwwQzQsNi4xLDMuNiw1LjgsMy42LDUuMmMwLTEsMC0yLDAtM2MwLTAuNSwwLjMtMC45LDAuOS0wLjljMSwwLDIsMCwzLDANCgkJYzAuNiwwLDAuOSwwLjMsMC45LDAuOWMwLDEsMCwyLDAsM2MwLDAuNi0wLjMsMC45LTAuOSwwLjlDNyw2LjEsNi41LDYuMSw2LDYuMXoiLz4NCgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMTQsNy43YzAuNSwwLDEsMCwxLjUsMGMwLjYsMCwwLjksMC4zLDAuOSwwLjljMCwxLDAsMiwwLDNjMCwwLjYtMC4zLDAuOS0wLjksMC45Yy0xLDAtMiwwLTMsMA0KCQljLTAuNSwwLTAuOS0wLjMtMC45LTAuOWMwLTEsMC0yLDAtM2MwLTAuNiwwLjMtMC45LDAuOS0wLjlDMTMsNy43LDEzLjUsNy43LDE0LDcuN3oiLz4NCgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNNy42LDE0LjFjMC41LDAsMSwwLDEuNSwwYzAuNSwwLDAuOSwwLjMsMC45LDAuOWMwLDEsMCwyLDAsMy4xYzAsMC41LTAuMywwLjktMC45LDAuOWMtMSwwLTIsMC0zLDANCgkJYy0wLjUsMC0wLjktMC4zLTAuOS0wLjljMC0xLDAtMiwwLTNjMC0wLjYsMC4zLTAuOSwwLjktMC45QzYuNiwxNC4xLDcuMSwxNC4xLDcuNiwxNC4xeiIvPg0KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik04LjgsNC41YzAtMC41LDAtMSwwLTEuNmMzLjYsMCw3LjIsMCwxMC44LDBjMCwwLjUsMCwxLDAsMS42QzE2LDQuNSwxMi40LDQuNSw4LjgsNC41eiIvPg0KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0wLjQsOS4zYzMuNiwwLDcuMiwwLDEwLjcsMGMwLDAuNSwwLDEsMCwxLjZjLTMuNiwwLTcuMSwwLTEwLjcsMEMwLjQsMTAuNCwwLjQsOS44LDAuNCw5LjN6Ii8+DQoJPHBhdGggY2xhc3M9InN0MSIgZD0iTTEwLjQsMTcuM2MwLTAuNSwwLTEsMC0xLjZjMy4xLDAsNi4xLDAsOS4yLDBjMCwwLjUsMCwxLDAsMS42QzE2LjUsMTcuMywxMy41LDE3LjMsMTAuNCwxNy4zeiIvPg0KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik00LjgsMTUuN2MwLDAuNSwwLDEsMCwxLjZjLTEuNSwwLTIuOSwwLTQuNCwwYzAtMC41LDAtMSwwLTEuNkMxLjksMTUuNywzLjMsMTUuNyw0LjgsMTUuN3oiLz4NCgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMy4yLDQuNWMtMC45LDAtMS44LDAtMi44LDBjMC0wLjUsMC0xLDAtMS42YzAuOSwwLDEuOCwwLDIuOCwwQzMuMiwzLjQsMy4yLDQsMy4yLDQuNXoiLz4NCgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMTYuOCw5LjNjMC45LDAsMS44LDAsMi44LDBjMCwwLjUsMCwxLDAsMS42Yy0wLjksMC0xLjgsMC0yLjgsMEMxNi44LDEwLjQsMTYuOCw5LjgsMTYuOCw5LjN6Ii8+DQo8L2c+DQo8L3N2Zz4NCg==';

    global $wp_custom_admin_interface_settings_page;
	$wp_custom_admin_interface_settings_page = add_menu_page( 'WP Custom Admin Interface', 'WP Custom </br>Admin Interface', 'manage_options', 'wp_custom_admin_interface', 'wp_custom_admin_interface_options_page',$menu_icon_svg);
}
/**
* 
*
*
* Gets, sets and renders options
*/
require('inc/options-output.php');
/**
* 
*
*
* The following functions output the callback of the sections
*/
function wp_custom_admin_interface_settings_general_callback(  ) { 
}
function wp_custom_admin_interface_settings_custom_code_callback(  ) { 
}
function wp_custom_admin_interface_maintenance_callback(  ) { 
}
function wp_custom_admin_interface_widget_callback(  ) { 
}



/**
* 
*
*
* Output the wrapper of the settings page and call the sections
*/
function wp_custom_admin_interface_options_page(  ) { 
    require('inc/options-page-wrapper.php');
}
/**
* 
*
*
* Add custom links to plugin on plugins page
*/
function wp_custom_admin_interface_plugin_links( $links, $file ) {
   if ( strpos( $file, 'wp-custom-admin-interface.php' ) !== false ) {
      $new_links = array(
               '<a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=R38R9NBWSPX28" target="_blank">' . __('Donate') . '</a>',
               '<a href="https://wordpress.org/support/plugin/wp-custom-admin-interface" target="_blank">' . __('Support Forum') . '</a>',
            );
      $links = array_merge( $links, $new_links );
   }
   return $links;
}
add_filter( 'plugin_row_meta', 'wp_custom_admin_interface_plugin_links', 10, 2 );
/**
* 
*
*
* Add settings link to plugin on plugins page
*/
function wp_custom_admin_interface_settings_link( $links ) {
    $settings_link = '<a href="admin.php?page=wp_custom_admin_interface">' . __( 'Settings' ) . '</a>';
    array_unshift( $links, $settings_link );
  	return $links;
}
$plugin = plugin_basename( __FILE__ );
add_filter( "plugin_action_links_$plugin", 'wp_custom_admin_interface_settings_link' );
/**
* 
*
*
* Load admin styles and scripts
*/
function wp_custom_admin_interface_register_admin($hook)
{
    
    //get settings page
    global $wp_custom_admin_interface_settings_page;
    
    //if the page isn't the settings page return nothing otherwise load scripts/styles
    if($hook != $wp_custom_admin_interface_settings_page)
        return;
    wp_enqueue_style( 'wp-color-picker' );
    wp_enqueue_script( 'custom-admin-script', plugins_url( '/inc/adminscript.js', __FILE__ ), array( 'jquery','wp-color-picker' ));
    wp_enqueue_script('jquery-ui-accordion');
    wp_enqueue_script('jquery-ui-tabs');
    wp_enqueue_script('jquery-ui-datepicker');
    wp_enqueue_script('clipboard', plugins_url('/inc/external/clipboard.min.js', __FILE__ ), array( 'jquery'));
    wp_enqueue_style( 'custom-admin-style', plugins_url( '/inc/adminstyle.css', __FILE__ ));
    wp_register_style( 'font-awesome-icons', 'https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css' );
    wp_register_style( 'code-mirror', plugins_url('/inc/external/codemirror.css', __FILE__ ));
    wp_enqueue_style( array('font-awesome-icons','code-mirror') );
    wp_enqueue_script( 'code-mirror-script', plugins_url('/inc/external/codemirror.js', __FILE__ ), array( 'jquery'));
    wp_enqueue_media();  
}
add_action( 'admin_enqueue_scripts', 'wp_custom_admin_interface_register_admin' );
/**
* 
*
*
* Function that displays settings tab content
*/
function wp_custom_admin_interface_tab_content ($tabName) {
    ?>
    <div class="tab-content" id="<?php echo $tabName; ?>">
        <div class="meta-box-sortables ui-sortable">
            <div class="postbox">
                <div class="inside">

                    <?php
                switch ($tabName){
                    
                    case "menuPage":
                    ?>
                        <p>I am sorry this page is currently under consideration. Please <a href="mailto:info@northernbeacheswebsites.com.au">email me</a> of what kind of controls you would like to see here to customise the admin menu. I am open to your ideas!</p>
                    
                        <p>
                        Your <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=R38R9NBWSPX28" target="_blank">donations</a> allow me to keep working on this plugin. Thank you for your support!    
                        </p>
                    
                        <?php
                        
                    /*    
                    global $submenu, $menu;
                        if ( current_user_can('manage_options') ) { // ONLY DO THIS FOR ADMIN
                            
                                echo '<pre>'; print_r( $menu ); echo '</pre>'; // TOP LEVEL MENUS
                                echo '<pre>'; print_r( $submenu ); echo '</pre>'; // SUBMENUS
                            
                        }
                    
                    */
                    ?>


                            <?php    
                    break;
                        
                    case "helpPage":
                    ?>
                                <p>Please use the <a target="_blank" href="https://wordpress.org/support/plugin/wp-custom-admin-interface">WordPress forum</a> to raise a support issue for the plugin. I generally respond to these within 24 hours during weekdays.</p>
                    
                                <p>
                                Your <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=R38R9NBWSPX28" target="_blank">donations</a> keep me interested in this plugin and encourage me to provide ongoing support. Thanks you!  
                                </p>
                                
                                <?php    
                    break;
                    
                    
                    case "importExportPage":
                    ?>
                    <table class="form-table">
                    <tr valign="top">
                        <td scope="row">
                        <label for="wp_custom_admin_interface_export_settings">Export Settings</label>
                        </td>
                        <td>
            
            
                            <?php  

                            $existingOptions = get_option("wp_custom_admin_interface_settings");  

                            $existingOptionsEncoded = base64_encode(serialize($existingOptions));

                            ?>

                            <button class="clipboard button-secondary" style="cursor:pointer;" data-clipboard-text="<?php echo $existingOptionsEncoded; ?>">Copy Settings</button>


                        </td>
                    </tr>
                    <tr valign="top">
                        <td scope="row">
                            <label for="wp_custom_admin_interface_import_settings">Import Settings</label>
                        </td>
                        <td>


                            <input class="wp_custom_admin_interface_settings_input" data="<?php echo wp_create_nonce('wp-custom-admin-interface-nonce'); ?>" name="wp_custom_admin_interface_settings[wp_custom_admin_interface_import_settings]" id="wp_custom_admin_interface_import_settings"> <button id="import-settings" class="button-secondary" style="cursor:pointer;">Import</button>


                        </td>
                    </tr>
                    </table>
                    
                    <?php    
                    break;    
                          
                    default:    
                    ?>
                        
 
                        <!--table-->
                        <table class="form-table">     
                            <?php if($tabName == "maintenancePage") {
                                echo "<p><em>Please note the login logo image and login page background color will be used on the maintenance/coming soon page.</em></p>";
                            } ?>    
                            
                            <!--fields-->
                            <?php
                            settings_fields($tabName);
                            do_settings_sections($tabName);
                            ?>

                            <button type="submit" name="submit" id="submit" class="button button-primary"><i class="fa fa-check-square" aria-hidden="true"></i> Save All Settings</button>
                        </table>


                        <?php    

                }
                ?>

                </div>
                <!-- .inside -->
            </div>
            <!-- .postbox -->
        </div>
        <!-- .meta-box-sortables -->
    </div>
    <!-- .tab-content -->
    <?php
}
/**
* 
*
*
* Function to replace string with shortcodes to variables
*/
function wp_custom_admin_interface_shortcode_replacer ($originalText) {
    
    $current_user = wp_get_current_user();
    
    $outPut = $originalText;
    
    //create an associative array to be used for shortcode replacement    
    $variables = array(
                    "website_title"=>get_bloginfo('name'),
                    "website_tagline"=>get_bloginfo('description'),
                    "website_url"=>get_bloginfo('url'),
                    "admin_email_address"=>get_bloginfo('admin_email'),
                    "user_first_name"=>$current_user->user_firstname,
                    "user_last_name"=>$current_user->user_lastname,
                    "user_nickname"=>$current_user->nickname,
                    "user_email"=>$current_user->user_email,
                    "current_year"=>date("Y"),
                ); 
    

    foreach($variables as $key => $value) { 
        $outPut = str_replace('['.strtoupper($key).']', $value, $outPut);    
    }
    
    echo $outPut;
}
/**
* 
*
*
* Function to replace footer text
*/
function wp_custom_admin_interface_remove_footer_admin () {
    //get options
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    if(isset($options['wp_custom_admin_interface_custom_footer'])){
        
        echo wp_custom_admin_interface_shortcode_replacer($options['wp_custom_admin_interface_custom_footer']); 
        
    }
}
add_filter('admin_footer_text', 'wp_custom_admin_interface_remove_footer_admin');
/**
* 
*
*
* Function to remove admin bar from front end
*/
function wp_custom_admin_interface_remove_admin_bar () {
$options = get_option( 'wp_custom_admin_interface_settings' );
    
    if(isset($options['wp_custom_admin_interface_remove_toolbar_frontend'])) {
        add_filter('show_admin_bar', '__return_false');    
    }
    
}
wp_custom_admin_interface_remove_admin_bar ();
$options = get_option( 'wp_custom_admin_interface_settings' );
/**
* 
*
*
* Function to change login styling
*/
function wp_custom_admin_interface_login_background_color() {
    
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    wp_enqueue_style( 'custom-login', plugins_url( '/inc/adminstyle.css', __FILE__ ) );
    wp_enqueue_script( 'custom-login-script', plugins_url( '/inc/adminloginscript.js', __FILE__ ), array( 'jquery') );
    
    
    if(isset($options['wp_custom_admin_interface_background_color']) && isset($options['wp_custom_admin_interface_custom_logo']) ){
        
        $colour_options = "
    .login {
	background-color: {$options['wp_custom_admin_interface_background_color']};
    }
    
    #login h1 a, .login h1 a {
        background-image: url({$options['wp_custom_admin_interface_custom_logo']});
		width:320px !important;
		background-size: contain !important;
		background-repeat: no-repeat;
    }
    
    ";
    
    wp_add_inline_style( 'custom-login', $colour_options );   
    }
      
}
add_action( 'login_enqueue_scripts', 'wp_custom_admin_interface_login_background_color' );
/**
* 
*
*
* Function to add custom css to Wordpress admin
*/
function wp_custom_admin_interface_custom_admin_css() {
    
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    if(isset($options['wp_custom_admin_interface_deactivate_code'])){} else {
        
        if(isset($options['wp_custom_admin_interface_custom_css_code'])){    
        
    
    wp_enqueue_style( 'custom-admin-css', plugins_url( '/inc/adminstyle.css', __FILE__ ) );
    
    $custom_code = "
    {$options['wp_custom_admin_interface_custom_css_code']} 
    ";
    wp_add_inline_style( 'custom-admin-css', $custom_code );

        }
    }
    
}

add_action('admin_head', 'wp_custom_admin_interface_custom_admin_css');
/**
* 
*
*
* Function to add custom javascript to Wordpress admin
*/
function wp_custom_admin_interface_custom_admin_javascript() {
    
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    
    if(isset($options['wp_custom_admin_interface_deactivate_code'])){} else {
        
    if(isset($options['wp_custom_admin_interface_custom_javascript_code'])){    
        
        
    wp_enqueue_script( 'custom-admin-javascript', plugins_url( '/inc/customadminscript.js', __FILE__ ), array( 'jquery') );

    
    $custom_code = "jQuery(document).ready(function ($) {
    {$options['wp_custom_admin_interface_custom_javascript_code']} 
    });";
    wp_add_inline_script( 'custom-admin-javascript', $custom_code );
    
    }
    }
}
add_action('admin_enqueue_scripts', 'wp_custom_admin_interface_custom_admin_javascript');
/**
* 
*
*
* This function removes the footer upgrade notice
*/
function wp_custom_admin_interface_remove_update_footer() {
    $options = get_option( 'wp_custom_admin_interface_settings' );
    if(isset($options['wp_custom_admin_interface_remove_footer'])) {
        remove_filter( 'update_footer', 'core_update_footer' );   
    } 
         
}
add_action( 'admin_menu', 'wp_custom_admin_interface_remove_update_footer' );
/**
* 
*
*
* Function to run upon ajax request to import settings
*/
function wp_custom_admin_interface_import_settings() {
    
    //check the nonce referrer exists
    check_ajax_referer( 'wp-custom-admin-interface-nonce', 'security' );

    // check if user can manage options    
    if ( ! current_user_can( 'manage_options') ){
        echo "You don't have permission to perform this action.";
        die(); 
    }
    
    //get user input
    $settings = $_POST['settings']; 
    
    //check if string length has some data and isn't blank
    if(strlen($settings)<845 || strpos($settings,' ') > 0) {
        echo "There's an error in the data you have entered. The import could not be processed.";
        die(); 
    }
    
    //unserialize and decode user input
    $extractedSettings = unserialize(base64_decode($settings));  
    
    //check if array length equals original setting array length
    if(count($extractedSettings) !== count(get_option("wp_custom_admin_interface_settings"))) {
        echo "There's been an error in the data you have entered. It could be because you are importing settings from another WordPress installation and that version of the plugin differs from this version. Please make sure both plugins are on the same version.";
        die();           
    }
    
    //check keys are plugin settings
    $errorCount = 0;
    
    foreach($extractedSettings as $key => $value) { 
        if(strpos($key, 'wp_custom_admin_interface') !== false) {} else {
            $errorCount++;   
        }
    }
    
    //if there's an error deliver message
    if($errorCount > 0) {
        echo "There's an error in the data you have entered. The import could not be processed.";
        die();    
    }
    
    //sanitize settings
    //$sanitizedSettings = array_map('sanitize_text_field',$extractedSettings);    
    
    //update options
    update_option('wp_custom_admin_interface_settings',$extractedSettings);    

    echo "success";    
    die();    
}
add_action( 'wp_ajax_import_settings', 'wp_custom_admin_interface_import_settings' );
/**
* 
*
*
* Function to enable maintenance mode
*/
function wp_custom_admin_interface_maintenance() {
    $options = get_option( 'wp_custom_admin_interface_settings' );
    global $pagenow;
    
    if(isset($options['wp_custom_admin_interface_maintenance_end'])) {
        if(strlen($options['wp_custom_admin_interface_maintenance_end'])>1){
        $maintenanceExpiryDate = $options['wp_custom_admin_interface_maintenance_end'];    
    } else {
        $maintenanceExpiryDate = "2050-01-01";    
    }} else {   
        $maintenanceExpiryDate = "2050-01-01";    
    }
    
    
    $todaysDate = date('Y-m-d');   
        
	if ($pagenow !== 'wp-login.php' && ! current_user_can( 'manage_options' ) && ! is_admin() && isset($options['wp_custom_admin_interface_enable_maintenance']) && $todaysDate < $maintenanceExpiryDate) {
		header( 'HTTP/1.1 Service Unavailable', true, 503 );
		header( 'Content-Type: text/html; charset=utf-8' );
        ?>

        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link rel="profile" href="http://gmpg.org/xfn/11">
            <style type="text/css">
            * {
              -webkit-box-sizing: border-box;
              -moz-box-sizing: border-box;
              box-sizing: border-box; }

            html, body {
              min-height: 100%; }

            body {
              background: <?php echo $options['wp_custom_admin_interface_background_color']; ?>;
              font-family: Helvetica, Arial, sans-serif;
              font-size: 18px;
              text-align: center; 
                
            }

            #container {
              margin: 40px auto;
              max-width: 600px;
              padding: 30px; 
              background: white;
              box-shadow: 0px 0px 5px 0px #e0dfdf;
              padding-bottom: 40px;
            }


            p {
              margin: 0 0 20px; }
                
            .logo {
             max-width:540px;             
            }
                
            @media screen and (max-width: 630px) {
            .logo {
             max-width:100%;             
            }   
            }
                
            </style>
            
            <title><?php echo esc_html( get_bloginfo( 'name' ) ); ?></title>
        </head>

        <body>
            <div id="container">
                <header>
                    <img class="logo" src="<?php echo $options['wp_custom_admin_interface_custom_logo']; ?>">
                </header>
                <main>
                    <?php echo $options['wp_custom_admin_interface_maintenance_text']; ?>
                </main>
            </div>
        </body>
        </html>

        <?php
		die();
	}
    
}
add_action( 'wp_loaded', 'wp_custom_admin_interface_maintenance' );
/**
* 
*
*
* Function output shortcodes
*/
function wp_custom_admin_interface_shortcode_output($class) {
    echo '</br>
    
    <a style="margin-bottom: 5px;" value="[CURRENT_YEAR]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[CURRENT_YEAR]</a>
    
    <a style="margin-bottom: 5px;" value="[WEBSITE_TITLE]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[WEBSITE_TITLE]</a>
    
    <a style="margin-bottom: 5px;" value="[WEBSITE_TAGLINE]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[WEBSITE_TAGLINE]</a>
    
    <a style="margin-bottom: 5px;" value="[WEBSITE_URL]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[WEBSITE_URL]</a>
    
    <a style="margin-bottom: 5px;" value="[ADMIN_EMAIL_ADDRESS]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[ADMIN_EMAIL_ADDRESS]</a>
    
    <a style="margin-bottom: 5px;" value="[USER_FIRST_NAME]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[USER_FIRST_NAME]</a>
    
    <a style="margin-bottom: 5px;" value="[USER_LAST_NAME]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[USER_LAST_NAME]</a>
    
    <a style="margin-bottom: 5px;" value="[USER_NICKNAME]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[USER_NICKNAME]</a>
    
    <a style="margin-bottom: 5px;" value="[USER_EMAIL]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[USER_EMAIL]</a>
    
    ';
    
}
/**
* 
*
*
* Function to add new dashboard widget
*/
function wp_custom_admin_interface_dashboard_widget() {
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    if(isset($options['wp_custom_admin_interface_enable_custom_widget'])) {
        
        if(strlen($options['wp_custom_admin_interface_custom_widget_title'])<1) {
            $widgetTitle = "Custom Widget";      
        } else {
            $widgetTitle = $options['wp_custom_admin_interface_custom_widget_title'];       
        }
        
        wp_add_dashboard_widget(
            'custom_widget',         // Widget slug.
            $widgetTitle,         // Title.
            'custom_widget_output' // Display function.
        );

        function custom_widget_output() {
            $options = get_option( 'wp_custom_admin_interface_settings' );
            echo wp_custom_admin_interface_shortcode_replacer($options['wp_custom_admin_interface_custom_widget_content']); 
        }
    }
}
add_action( 'wp_dashboard_setup', 'wp_custom_admin_interface_dashboard_widget' );
/**
* 
*
*
* Function to run PHP code
*/
function wp_custom_admin_interface_run_php() {
$options = get_option( 'wp_custom_admin_interface_settings' );
    if(isset($options['wp_custom_admin_interface_deactivate_code'])){} else {
        if(isset($options['wp_custom_admin_interface_custom_php_code'])){

            $content = $options['wp_custom_admin_interface_custom_php_code']; 

            @eval($content);    
        }
    }
}
wp_custom_admin_interface_run_php();


?>