<?php

/*
*		Plugin Name: WP Custom Admin Interface
*		Plugin URI: https://www.northernbeacheswebsites.com.au
*		Description: Customise the WordPress admin and login interfaces and customize the WordPress dashboard menu.  
*		Version: 3.12
*		Author: Martin Gibson
*		Developer: Northern Beaches Websites
*		Developer URI:  https://www.northernbeacheswebsites.com.au
*		Text Domain: wp-custom-admin-interface 
*       Copyright: Â©2017 Northern Beaches Websites.
*		Support: https://www.northernbeacheswebsites.com.au/contact
*		Licence: GNU General Public License v3.0
*       License URI: http://www.gnu.org/licenses/gpl-3.0.html
*/



/**
* 
*
*
* Create admin menu and add it to a global variable so that admin styles/scripts can hook into it
*/
add_action( 'admin_menu', 'wp_custom_admin_interface_add_admin_menu' );
add_action( 'admin_init', 'wp_custom_admin_interface_settings_init' );

function wp_custom_admin_interface_add_admin_menu(  ) { 
    $menu_icon_svg = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMS4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCAyMCAyMCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjAgMjA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJLnN0MHtmaWxsOiNGRkZGRkY7fQ0KCS5zdDF7ZmlsbDojQTBBNUFBO30NCjwvc3R5bGU+DQo8cGF0aCBjbGFzcz0ic3QwIiBkPSJNLTM2OC4xLTE4LjljMC04MS43LDAtMTYzLjMsMC0yNDVjODcuNSwwLDE3NSwwLDI2Mi41LDBjMCw4MS43LDAsMTYzLjMsMCwyNDUNCglDLTE5My4xLTE4LjktMjgwLjYtMTguOS0zNjguMS0xOC45eiBNLTI5MC43LTE5MS45YzYuMiwwLDEyLjUsMCwxOC43LDBjNy4yLDAsMTEuMy00LjEsMTEuMy0xMS4yYzAtMTIuNSwwLTI1LDAtMzcuNQ0KCWMwLTcuMS00LjEtMTEuMi0xMS4xLTExLjJjLTEyLjYsMC0yNS4yLDAtMzcuNywwYy02LjksMC0xMS4xLDQuMS0xMS4xLDExYzAsMTIuNywwLDI1LjMsMCwzOGMwLDYuNyw0LjIsMTAuOSwxMC45LDExDQoJQy0zMDMuNC0xOTEuOS0yOTctMTkxLjktMjkwLjctMTkxLjl6IE0tMTkwLjYtMTcxLjljLTYuMywwLTEyLjcsMC0xOSwwYy02LjksMC0xMSw0LjItMTEsMTEuMWMwLDEyLjYsMCwyNS4yLDAsMzcuNw0KCWMwLDYuOSw0LjEsMTEuMSwxMSwxMS4xYzEyLjcsMCwyNS4zLDAsMzgsMGM2LjgsMCwxMS00LjIsMTEtMTEuMWMwLTEyLjYsMC0yNS4yLDAtMzcuN2MwLTctNC4xLTExLjEtMTEuMi0xMS4xDQoJQy0xNzguMS0xNzEuOS0xODQuMy0xNzEuOS0xOTAuNi0xNzEuOXogTS0yNzAuNi05MS44Yy02LjIsMC0xMi41LDAtMTguNywwYy03LjEsMC0xMS4yLDQuMS0xMS4yLDExLjFjMCwxMi42LDAsMjUuMiwwLDM3LjcNCgljMCw2LjksNC4xLDExLjEsMTEsMTEuMWMxMi43LDAsMjUuMywwLDM4LDBjNi44LDAsMTAuOS00LjIsMTEtMTAuOWMwLTEyLjcsMC0yNS41LDAtMzguMmMwLTYuNi00LjItMTAuOC0xMC44LTEwLjgNCglDLTI1Ny44LTkxLjktMjY0LjItOTEuOC0yNzAuNi05MS44eiBNLTI1NS41LTIxMi4xYzQ1LjEsMCw4OS45LDAsMTM0LjcsMGMwLTYuNiwwLTEzLjEsMC0xOS42Yy00NSwwLTg5LjgsMC0xMzQuNywwDQoJQy0yNTUuNS0yMjUuMS0yNTUuNS0yMTguNy0yNTUuNS0yMTIuMXogTS0zNjAuNC0xNTEuOGMwLDYuOCwwLDEzLjMsMCwxOS43YzQ1LDAsODkuOCwwLDEzNC42LDBjMC02LjcsMC0xMy4yLDAtMTkuNw0KCUMtMjcwLjctMTUxLjgtMzE1LjUtMTUxLjgtMzYwLjQtMTUxLjh6IE0tMjM1LjUtNTIuMWMzOC40LDAsNzYuNiwwLDExNC43LDBjMC02LjcsMC0xMy4xLDAtMTkuNmMtMzguMywwLTc2LjUsMC0xMTQuNywwDQoJQy0yMzUuNS02NS4xLTIzNS41LTU4LjctMjM1LjUtNTIuMXogTS0zMDUuNy03MS43Yy0xOC40LDAtMzYuNiwwLTU0LjcsMGMwLDYuNywwLDEzLjEsMCwxOS42YzE4LjMsMCwzNi41LDAsNTQuNywwDQoJQy0zMDUuNy01OC43LTMwNS43LTY1LjEtMzA1LjctNzEuN3ogTS0zMjUuOC0yMTJjMC02LjcsMC0xMy4zLDAtMTkuN2MtMTEuNywwLTIzLjEsMC0zNC42LDBjMCw2LjcsMCwxMy4yLDAsMTkuNw0KCUMtMzQ4LjgtMjEyLTMzNy40LTIxMi0zMjUuOC0yMTJ6IE0tMTU1LjQtMTUxLjdjMCw2LjcsMCwxMy4xLDAsMTkuN2MxMS42LDAsMjMuMiwwLDM0LjcsMGMwLTYuNiwwLTEzLjEsMC0xOS43DQoJQy0xMzIuMy0xNTEuNy0xNDMuOC0xNTEuNy0xNTUuNC0xNTEuN3oiLz4NCjxnPg0KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik02LDYuMWMtMC41LDAtMSwwLTEuNSwwQzQsNi4xLDMuNiw1LjgsMy42LDUuMmMwLTEsMC0yLDAtM2MwLTAuNSwwLjMtMC45LDAuOS0wLjljMSwwLDIsMCwzLDANCgkJYzAuNiwwLDAuOSwwLjMsMC45LDAuOWMwLDEsMCwyLDAsM2MwLDAuNi0wLjMsMC45LTAuOSwwLjlDNyw2LjEsNi41LDYuMSw2LDYuMXoiLz4NCgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMTQsNy43YzAuNSwwLDEsMCwxLjUsMGMwLjYsMCwwLjksMC4zLDAuOSwwLjljMCwxLDAsMiwwLDNjMCwwLjYtMC4zLDAuOS0wLjksMC45Yy0xLDAtMiwwLTMsMA0KCQljLTAuNSwwLTAuOS0wLjMtMC45LTAuOWMwLTEsMC0yLDAtM2MwLTAuNiwwLjMtMC45LDAuOS0wLjlDMTMsNy43LDEzLjUsNy43LDE0LDcuN3oiLz4NCgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNNy42LDE0LjFjMC41LDAsMSwwLDEuNSwwYzAuNSwwLDAuOSwwLjMsMC45LDAuOWMwLDEsMCwyLDAsMy4xYzAsMC41LTAuMywwLjktMC45LDAuOWMtMSwwLTIsMC0zLDANCgkJYy0wLjUsMC0wLjktMC4zLTAuOS0wLjljMC0xLDAtMiwwLTNjMC0wLjYsMC4zLTAuOSwwLjktMC45QzYuNiwxNC4xLDcuMSwxNC4xLDcuNiwxNC4xeiIvPg0KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik04LjgsNC41YzAtMC41LDAtMSwwLTEuNmMzLjYsMCw3LjIsMCwxMC44LDBjMCwwLjUsMCwxLDAsMS42QzE2LDQuNSwxMi40LDQuNSw4LjgsNC41eiIvPg0KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0wLjQsOS4zYzMuNiwwLDcuMiwwLDEwLjcsMGMwLDAuNSwwLDEsMCwxLjZjLTMuNiwwLTcuMSwwLTEwLjcsMEMwLjQsMTAuNCwwLjQsOS44LDAuNCw5LjN6Ii8+DQoJPHBhdGggY2xhc3M9InN0MSIgZD0iTTEwLjQsMTcuM2MwLTAuNSwwLTEsMC0xLjZjMy4xLDAsNi4xLDAsOS4yLDBjMCwwLjUsMCwxLDAsMS42QzE2LjUsMTcuMywxMy41LDE3LjMsMTAuNCwxNy4zeiIvPg0KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik00LjgsMTUuN2MwLDAuNSwwLDEsMCwxLjZjLTEuNSwwLTIuOSwwLTQuNCwwYzAtMC41LDAtMSwwLTEuNkMxLjksMTUuNywzLjMsMTUuNyw0LjgsMTUuN3oiLz4NCgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMy4yLDQuNWMtMC45LDAtMS44LDAtMi44LDBjMC0wLjUsMC0xLDAtMS42YzAuOSwwLDEuOCwwLDIuOCwwQzMuMiwzLjQsMy4yLDQsMy4yLDQuNXoiLz4NCgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMTYuOCw5LjNjMC45LDAsMS44LDAsMi44LDBjMCwwLjUsMCwxLDAsMS42Yy0wLjksMC0xLjgsMC0yLjgsMEMxNi44LDEwLjQsMTYuOCw5LjgsMTYuOCw5LjN6Ii8+DQo8L2c+DQo8L3N2Zz4NCg==';

    global $wp_custom_admin_interface_settings_page;
	$wp_custom_admin_interface_settings_page = add_menu_page( 'WP Custom Admin Interface', 'Custom Admin Interface', 'manage_options', 'wp_custom_admin_interface', 'wp_custom_admin_interface_options_page',$menu_icon_svg);
}
/**
* 
*
*
* Gets, sets and renders options
*/
require('inc/options-output.php');
/**
* 
*
*
* Output the wrapper of the settings page and call the sections
*/
function wp_custom_admin_interface_options_page(  ) { 
    require('inc/options-page-wrapper.php');
}
/**
* 
*
*
* Add custom links to plugin on plugins page
*/
function wp_custom_admin_interface_plugin_links( $links, $file ) {
   if ( strpos( $file, 'wp-custom-admin-interface.php' ) !== false ) {
      $new_links = array(
               '<a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=R38R9NBWSPX28" target="_blank">' . __('Donate') . '</a>',
               '<a href="https://wordpress.org/support/plugin/wp-custom-admin-interface" target="_blank">' . __('Support Forum','wp-custom-admin-interface') . '</a>',
            );
      $links = array_merge( $links, $new_links );
   }
   return $links;
}
add_filter( 'plugin_row_meta', 'wp_custom_admin_interface_plugin_links', 10, 2 );
/**
* 
*
*
* Add settings link to plugin on plugins page
*/
function wp_custom_admin_interface_settings_link( $links ) {
    $settings_link = '<a href="admin.php?page=wp_custom_admin_interface">' . __( 'Settings','wp-custom-admin-interface' ) . '</a>';
    array_unshift( $links, $settings_link );
  	return $links;
}
$plugin = plugin_basename( __FILE__ );
add_filter( "plugin_action_links_$plugin", 'wp_custom_admin_interface_settings_link' );
/**
* 
*
*
* Load admin styles and scripts
*/
function wp_custom_admin_interface_register_admin($hook)
{
    
    //get settings page
    global $wp_custom_admin_interface_settings_page;
    
    //if the page isn't the settings page return nothing otherwise load scripts/styles
    if($hook != $wp_custom_admin_interface_settings_page)
        return;
    wp_enqueue_style( 'wp-color-picker' );
    wp_enqueue_script( 'custom-admin-script', plugins_url( '/inc/adminscript-min.js', __FILE__ ), array( 'jquery','wp-color-picker' ));
    wp_enqueue_script('jquery-ui-accordion');
    wp_enqueue_script('jquery-ui-tabs');
    wp_enqueue_script('jquery-ui-datepicker');
    wp_enqueue_script('jquery-ui-dialog');
    wp_enqueue_script('jquery-ui-sortable');
    wp_enqueue_script('clipboard', plugins_url('/inc/external/clipboard.min.js', __FILE__ ), array( 'jquery'));
    
    
    wp_enqueue_script('nested-sortable', plugins_url('/inc/external/jquery.mjs.nestedSortable-min.js', __FILE__ ), array( 'jquery','jquery-ui-sortable'));
    
    
    wp_enqueue_style( 'custom-admin-style', plugins_url( '/inc/adminstyle-min.css', __FILE__ ));
    
    
    wp_register_style( 'font-awesome-icons', plugins_url( '/inc/external/font-awesome.min.css', __FILE__ ));
    

    wp_register_style( 'code-mirror', plugins_url('/inc/external/codemirror.css', __FILE__ ));
    wp_enqueue_style( array('font-awesome-icons','code-mirror') );
    wp_enqueue_script( 'code-mirror-script', plugins_url('/inc/external/codemirror.js', __FILE__ ), array( 'jquery'));
    wp_enqueue_media();  
}
add_action( 'admin_enqueue_scripts', 'wp_custom_admin_interface_register_admin' );
/**
* 
*
*
* Function that displays settings tab content
*/
function wp_custom_admin_interface_tab_content ($tabName) {
    ?>
    <div class="tab-content" id="<?php echo $tabName; ?>">
        <div class="meta-box-sortables ui-sortable">
            <div class="postbox">
                <div class="inside">

                    <?php
                switch ($tabName){
                    
                    case "helpPage":
                    
                    $date = new DateTime("now", new DateTimeZone('Australia/Sydney') );
                        
                    ?>
                                <p><?php _e('Please use the', 'wp-custom-admin-interface' ); ?> <a target="_blank" href="https://wordpress.org/support/plugin/wp-custom-admin-interface">WordPress <?php _e('forum', 'wp-custom-admin-interface' ); ?></a> <?php _e('to raise a support issue for the plugin. I generally respond to these within 24 hours during weekdays. Currently it\'s', 'wp-custom-admin-interface' ); ?> <?php echo $date->format('g:iA').' on '.  $date->format('l'); ?> <?php _e('down under! Also check out the below walkthrough video:', 'wp-custom-admin-interface' ); ?></p>
                                
                    
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/bIfPaWnSUvk?rel=0&amp;showinfo=0" frameborder="0" allowfullscreen></iframe>    
                    
                                <p>
                                <?php _e('Your', 'wp-custom-admin-interface' ); ?> <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=R38R9NBWSPX28" target="_blank"><?php _e('donations', 'wp-custom-admin-interface' ); ?></a> <?php _e('keep me interested in this plugin and encourage me to provide ongoing support. Thank you!', 'wp-custom-admin-interface' ); ?>  
                                </p>
                    
                                <h3 style="padding-left: 10px;"><?php _e('Diagnostic Information', 'wp-custom-admin-interface' ); ?></h3>
                                <p style="padding-top: 0px; padding-bottom: 0px;"><?php _e('To assist me with your support request I may ask you to provide the following information:', 'wp-custom-admin-interface' ); ?></p>
                                <p><code><?php echo 'PHP Version: <strong>'.phpversion().'</strong>'; ?></br>
                                <?php echo 'Wordpress Version: <strong>'.get_bloginfo('version').'</strong>'; ?></br>
                                Plugin Version: <strong><?php echo wpgotowebinar_plugin_get_version(); ?></strong></br>
                                Current Theme: <strong><?php 
                                $user_theme = wp_get_theme();    
                                echo esc_html( $user_theme->get( 'Name' ) );
                                ?></strong></br>

                                Active Plugins:</br> 
                                <?php 
                                $active_plugins=get_option('active_plugins');
                                $plugins=get_plugins();
                                $activated_plugins=array();
                                foreach ($active_plugins as $plugin){           
                                array_push($activated_plugins, $plugins[$plugin]);     
                                } 

                                foreach ($activated_plugins as $key){  
                                echo '<strong>'.$key['Name'].'</strong></br>';
                                }

                                ?></code></p>

                                
                                <?php    
                    break;
                    
                    case "requestFeaturePage":
                    ?>
                                <p><?php _e('Thanks for using the plugin! Please use this form to request a feature. I can\'t guarantee it will make its way into the production release but if it\'s decent enough I will try my best. Thanks for contributing and making the plugin even better! If you haven\'t already please consider rating the plugin', 'wp-custom-admin-interface' ); ?> <a href="https://wordpress.org/support/plugin/wp-custom-admin-interface/reviews/?rate=5#new-post" target="_blank"><i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star" aria-hidden="true"></i></a>'s.</p>
                                

                                <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSf69lqYxf2AmiAH0owdj7lS5-pzypjyxhTbfbdxOn_QdhxV0g/viewform?embedded=true" width="760" height="500" frameborder="0" marginheight="0" marginwidth="0">Loading...</iframe>
                    

                                
                                <?php    
                    break;    
                        

                        
                    
                    case "importExportPage":
                    ?>
                    <table class="form-table">
                    <tr valign="top">
                        <td scope="row">
                        <label for="wp_custom_admin_interface_export_settings"><?php _e('Export Settings', 'wp-custom-admin-interface' ); ?></label>
                        </td>
                        <td>
            
            
                            <?php  

                            $existingOptions = get_option("wp_custom_admin_interface_settings");  

                            $existingOptionsEncoded = base64_encode(serialize($existingOptions));

                            ?>

                            <button class="clipboard button-secondary" style="cursor:pointer;" data-clipboard-text="<?php echo $existingOptionsEncoded; ?>"><?php _e('Copy Settings', 'wp-custom-admin-interface' ); ?></button>


                        </td>
                    </tr>
                    <tr valign="top">
                        <td scope="row">
                            <label for="wp_custom_admin_interface_import_settings"><?php _e('Import Settings', 'wp-custom-admin-interface' ); ?></label>
                        </td>
                        <td>


                            <input class="wp_custom_admin_interface_settings_input" data="<?php echo wp_create_nonce('wp-custom-admin-interface-nonce'); ?>" name="wp_custom_admin_interface_settings[wp_custom_admin_interface_import_settings]" id="wp_custom_admin_interface_import_settings"> <button id="import-settings" class="button-secondary" style="cursor:pointer;"><?php _e('Import', 'wp-custom-admin-interface' ); ?></button>


                        </td>
                    </tr>
                    </table>
                    
                    <?php    
                    break;    
                          
                    default:    
                    ?>
                        
 
                        <!--table-->
                        <table class="form-table">     
                            <?php if($tabName == "maintenancePage") {
                                echo "<p><em>Please note the login logo image, login page background color and custom favicon will be used on the maintenance/coming soon page.</em></p>";
                            } ?>    
                            
                            <!--fields-->
                            <?php
                            settings_fields($tabName);
                            do_settings_sections($tabName);
                            ?>
                            
                            <button style="margin-left: 0px !important;" id="pre-submit" class="button button-primary"><i class="fa fa-check-square" aria-hidden="true"></i> <?php _e('Save All Settings', 'wp-custom-admin-interface' ); ?></button> 
                            
                            <button type="submit" name="submit" id="submit" class="button button-primary"><i class="fa fa-check-square" aria-hidden="true"></i> <?php _e('Save All Settings', 'wp-custom-admin-interface' ); ?></button>
                        </table>


                        <?php    

                }
                ?>

                </div>
                <!-- .inside -->
            </div>
            <!-- .postbox -->
        </div>
        <!-- .meta-box-sortables -->
    </div>
    <!-- .tab-content -->
    <?php
}
/**
* 
*
*
* Function to replace string with shortcodes to variables
*/
function wp_custom_admin_interface_shortcode_replacer ($originalText) {
    
    $current_user = wp_get_current_user();
    
    $outPut = $originalText;
    
    //create an associative array to be used for shortcode replacement    
    $variables = array(
                    "website_title"=>get_bloginfo('name'),
                    "website_tagline"=>get_bloginfo('description'),
                    "website_url"=>get_bloginfo('url'),
                    "admin_email_address"=>get_bloginfo('admin_email'),
                    "user_first_name"=>$current_user->user_firstname,
                    "user_last_name"=>$current_user->user_lastname,
                    "user_nickname"=>$current_user->nickname,
                    "user_email"=>$current_user->user_email,
                    "current_year"=>date("Y"),
                ); 
    

    foreach($variables as $key => $value) { 
        $outPut = str_replace('['.strtoupper($key).']', $value, $outPut);    
    }
    
    echo $outPut;
}
/**
* 
*
*
* Function to replace footer text
*/
function wp_custom_admin_interface_remove_footer_admin () {
    //get options
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    if(isset($options['wp_custom_admin_interface_custom_footer']) && strlen($options['wp_custom_admin_interface_custom_footer'])>0){
        echo wp_custom_admin_interface_shortcode_replacer($options['wp_custom_admin_interface_custom_footer']); 
    }
}
add_filter('admin_footer_text', 'wp_custom_admin_interface_remove_footer_admin');
/**
* 
*
*
* Function to remove admin bar from front end
*/
function wp_custom_admin_interface_remove_admin_bar () {
$options = get_option( 'wp_custom_admin_interface_settings' );
    
    if(isset($options['wp_custom_admin_interface_remove_toolbar_frontend'])) {
        add_filter('show_admin_bar', '__return_false');    
    }
    
}
wp_custom_admin_interface_remove_admin_bar ();
$options = get_option( 'wp_custom_admin_interface_settings' );
/**
* 
*
*
* Function to change login styling
*/
function wp_custom_admin_interface_login_background_color() {
    
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    wp_enqueue_style( 'custom-login', plugins_url( '/inc/adminstyle-min.css', __FILE__ ) );
    wp_enqueue_script( 'custom-login-script', plugins_url( '/inc/adminloginscript-min.js', __FILE__ ), array( 'jquery') );
    
    
    if(isset($options['wp_custom_admin_interface_background_color']) && isset($options['wp_custom_admin_interface_custom_logo']) ){
        
        $colour_options = "
    .login {
	background-color: {$options['wp_custom_admin_interface_background_color']};
    }
    
    #login h1 a, .login h1 a {
        background-image: url({$options['wp_custom_admin_interface_custom_logo']});
		width:320px !important;
		background-size: contain !important;
		background-repeat: no-repeat;
    }
    
    ";
    
    wp_add_inline_style( 'custom-login', $colour_options );   
    }
      
}
add_action( 'login_enqueue_scripts', 'wp_custom_admin_interface_login_background_color' );
/**
* 
*
*
* Function to change login styling with custom CSS
*/
function wp_custom_admin_interface_custom_login_css() {

$options = get_option( 'wp_custom_admin_interface_settings' );    
    
    if(isset($options['wp_custom_admin_interface_deactivate_code'])){} else {

            if(isset($options['wp_custom_admin_interface_custom_login_css_code'])){    
            ?>
            <style>
            <?php echo wp_strip_all_tags($options['wp_custom_admin_interface_custom_login_css_code']); ?>
            </style>    
            <?php    

            }
    }      
}
add_filter( 'login_head', 'wp_custom_admin_interface_custom_login_css' );
/**
* 
*
*
* Function to add custom css to Wordpress admin
*/
function wp_custom_admin_interface_custom_admin_css() {
    
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    if(isset($options['wp_custom_admin_interface_deactivate_code'])){} else {
        
        if(isset($options['wp_custom_admin_interface_custom_css_code'])){    
        ?>
        <style>
        <?php echo wp_strip_all_tags($options['wp_custom_admin_interface_custom_css_code']); ?>
        </style>    
        <?php    
            
        }
    }
    
    
    if(isset($options['wp_custom_admin_interface_button_link_color']) && $options['wp_custom_admin_interface_button_link_color'] !== "#0085ba"){
        
        wp_enqueue_style( 'custom-admin-css', plugins_url( '/inc/adminstyle-min.css', __FILE__ ) );
        
        $buttonLinkColor = wp_strip_all_tags($options['wp_custom_admin_interface_button_link_color']);
        
        $custom_code = "
        
        a {
        color: {$buttonLinkColor};
        }
        
        .wp-core-ui .button-primary {
            background: {$buttonLinkColor};
            background-image: -webkit-gradient(linear,left top,left bottom,from({$buttonLinkColor}),to({$buttonLinkColor}));
            background-image: -webkit-linear-gradient(top,{$buttonLinkColor},{$buttonLinkColor});
            background-image: -moz-linear-gradient(top,{$buttonLinkColor},{$buttonLinkColor});
            background-image: -ms-linear-gradient(top,{$buttonLinkColor},{$buttonLinkColor});
            background-image: -o-linear-gradient(top,{$buttonLinkColor},{$buttonLinkColor});
            background-image: linear-gradient(to bottom,{$buttonLinkColor},{$buttonLinkColor});
            border-color: {$buttonLinkColor};
            text-shadow: none !important;
            box-shadow: none !important;
        }
        ";
        wp_add_inline_style( 'custom-admin-css', $custom_code );
          
    }
    
    
    if(isset($options['wp_custom_admin_interface_button_link_hover_color']) && $options['wp_custom_admin_interface_button_link_hover_color'] !== "#008ec2"){
        
        wp_enqueue_style( 'custom-admin-css', plugins_url( '/inc/adminstyle-min.css', __FILE__ ) );
        
        $buttonLinkHoverColor = wp_strip_all_tags($options['wp_custom_admin_interface_button_link_hover_color']);
        
        $custom_code = "
        a:hover, a:active {
        color: {$buttonLinkHoverColor};
        }
        
        .wp-core-ui .button-primary.active, .wp-core-ui .button-primary:hover, .wp-core-ui .button-primary:active {
            background: {$buttonLinkHoverColor};
            background-image: -webkit-gradient(linear,left top,left bottom,from({$buttonLinkHoverColor}),to({$buttonLinkHoverColor}));
            background-image: -webkit-linear-gradient(top,{$buttonLinkHoverColor},{$buttonLinkHoverColor});
            background-image: -moz-linear-gradient(top,{$buttonLinkHoverColor},{$buttonLinkHoverColor});
            background-image: -ms-linear-gradient(top,{$buttonLinkHoverColor},{$buttonLinkHoverColor});
            background-image: -o-linear-gradient(top,{$buttonLinkHoverColor},{$buttonLinkHoverColor});
            background-image: linear-gradient(to bottom,{$buttonLinkHoverColor},{$buttonLinkHoverColor});
            border-color: {$buttonLinkHoverColor};
            text-shadow: none !important;
            box-shadow: none !important;
        }
        ";
        wp_add_inline_style( 'custom-admin-css', $custom_code );
          
    }
    
}

add_action('admin_head', 'wp_custom_admin_interface_custom_admin_css');
/**
* 
*
*
* Function to add custom javascript to Wordpress admin
*/
function wp_custom_admin_interface_custom_admin_javascript() {
    
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    
    if(isset($options['wp_custom_admin_interface_deactivate_code'])){} else {
        
    if(isset($options['wp_custom_admin_interface_custom_javascript_code'])){    
        
        
    wp_enqueue_script( 'custom-admin-javascript', plugins_url( '/inc/customadminscript-min.js', __FILE__ ), array( 'jquery') );

    
    $custom_code = "jQuery(document).ready(function ($) {
    {$options['wp_custom_admin_interface_custom_javascript_code']} 
    });";
    wp_add_inline_script( 'custom-admin-javascript', $custom_code );
    
    }
    }
}
add_action('admin_enqueue_scripts', 'wp_custom_admin_interface_custom_admin_javascript');
/**
* 
*
*
* This function removes the footer upgrade notice
*/
function wp_custom_admin_interface_remove_update_footer() {
    $options = get_option( 'wp_custom_admin_interface_settings' );
    if(isset($options['wp_custom_admin_interface_remove_footer'])) {
        remove_filter( 'update_footer', 'core_update_footer' );   
    } 
         
}
add_action( 'admin_menu', 'wp_custom_admin_interface_remove_update_footer' );
/**
* 
*
*
* Function to run upon ajax request to import settings
*/
function wp_custom_admin_interface_import_settings() {
    
    //check the nonce referrer exists
    check_ajax_referer( 'wp-custom-admin-interface-nonce', 'security' );

    // check if user can manage options    
    if ( ! current_user_can( 'manage_options') ){
        echo "You don't have permission to perform this action.";
        die(); 
    }
    
    //get user input
    $settings = $_POST['settings']; 
    
    //check if string length has some data and isn't blank
    if(strlen($settings)<845 || strpos($settings,' ') > 0) {
        echo "There's an error in the data you have entered. The import could not be processed.";
        die(); 
    }
    
    //unserialize and decode user input
    $extractedSettings = unserialize(base64_decode($settings)); 
    
    
    //function to remove checkboxes from settings count
    function removeCheckBoxesFromSettingCount($settingsArray) {
        
        $originalCount = count($settingsArray);
        $revisedCount = 0;
        
        foreach($settingsArray as $key => $value) {
            if($value !== "1"){
                $revisedCount++;     
            }       
        }
        return $revisedCount;     
    }
    
    $importSettingsCount = removeCheckBoxesFromSettingCount($extractedSettings);
    $originalSettingsCount = removeCheckBoxesFromSettingCount(get_option("wp_custom_admin_interface_settings")); 
    

    //check if array length equals original setting array length
    if($importSettingsCount !== $originalSettingsCount) {
        echo "There's been an error. It could be because you are importing settings from another WordPress installation and that version of the plugin differs from this version. Please make sure both plugins are on the same version. Alternatively, if you haven't saved the settings yet for the plugin please do this first and then try again and this should work.";
        die();           
    }
    
    //check keys are plugin settings
    $errorCount = 0;
    
    foreach($extractedSettings as $key => $value) { 
        if(strpos($key, 'wp_custom_admin_interface') !== false) {} else {
            $errorCount++;   
        }
    }
    
    //if there's an error deliver message
    if($errorCount > 0) {
        echo "There's an error in the data you have entered. The import could not be processed.";
        die();    
    }   
    
    //update options
    update_option('wp_custom_admin_interface_settings',$extractedSettings);    

    echo "success";    
    die();    
}
add_action( 'wp_ajax_import_settings', 'wp_custom_admin_interface_import_settings' );
/**
* 
*
*
* Function to enable maintenance mode
*/
function wp_custom_admin_interface_maintenance() {
    $options = get_option( 'wp_custom_admin_interface_settings' );
    global $pagenow;
    
    if(isset($options['wp_custom_admin_interface_maintenance_end'])) {
        if(strlen($options['wp_custom_admin_interface_maintenance_end'])>1){
        $maintenanceExpiryDate = $options['wp_custom_admin_interface_maintenance_end'];    
    } else {
        $maintenanceExpiryDate = "2050-01-01";    
    }} else {   
        $maintenanceExpiryDate = "2050-01-01";    
    }
    
    
    $todaysDate = date('Y-m-d');   
        
	if ($pagenow !== 'wp-login.php' && ! current_user_can( 'manage_options' ) && ! is_admin() && isset($options['wp_custom_admin_interface_enable_maintenance']) && $todaysDate < $maintenanceExpiryDate) {
		header( 'HTTP/1.1 Service Unavailable', true, 503 );
		header( 'Content-Type: text/html; charset=utf-8' );
        ?>

        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link rel="profile" href="http://gmpg.org/xfn/11">
            <style type="text/css">
            * {
              -webkit-box-sizing: border-box;
              -moz-box-sizing: border-box;
              box-sizing: border-box; }

            html, body {
              min-height: 100%; }

            body {
              background: <?php echo $options['wp_custom_admin_interface_background_color']; ?>;
              font-family: Helvetica, Arial, sans-serif;
              font-size: 18px;
              text-align: center; 
                
            }

            #container {
              margin: 40px auto;
              max-width: 600px;
              padding: 30px; 
              background: white;
              box-shadow: 0px 0px 5px 0px #e0dfdf;
              padding-bottom: 40px;
            }


            p {
              margin: 0 0 20px; }
                
            .logo {
             max-width:540px;             
            }
                
            @media screen and (max-width: 630px) {
            .logo {
             max-width:100%;             
            }   
            }
                
            </style>
            
            <title><?php echo esc_html( get_bloginfo( 'name' ) ); ?></title>
        </head>

        <body>
            <div id="container">
                <header>
                    <img class="logo" src="<?php echo $options['wp_custom_admin_interface_custom_logo']; ?>">
                </header>
                <main>
                    <?php echo $options['wp_custom_admin_interface_maintenance_text']; ?>
                </main>
            </div>
        </body>
        </html>

        <?php
		die();
	}
    
}
add_action( 'wp_loaded', 'wp_custom_admin_interface_maintenance' );
/**
* 
*
*
* Function output shortcodes
*/
function wp_custom_admin_interface_shortcode_output($class) {
    echo '</br>
    
    <a style="margin-bottom: 5px;" value="[CURRENT_YEAR]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[CURRENT_YEAR]</a>
    
    <a style="margin-bottom: 5px;" value="[WEBSITE_TITLE]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[WEBSITE_TITLE]</a>
    
    <a style="margin-bottom: 5px;" value="[WEBSITE_TAGLINE]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[WEBSITE_TAGLINE]</a>
    
    <a style="margin-bottom: 5px;" value="[WEBSITE_URL]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[WEBSITE_URL]</a>
    
    <a style="margin-bottom: 5px;" value="[ADMIN_EMAIL_ADDRESS]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[ADMIN_EMAIL_ADDRESS]</a>
    
    <a style="margin-bottom: 5px;" value="[USER_FIRST_NAME]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[USER_FIRST_NAME]</a>
    
    <a style="margin-bottom: 5px;" value="[USER_LAST_NAME]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[USER_LAST_NAME]</a>
    
    <a style="margin-bottom: 5px;" value="[USER_NICKNAME]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[USER_NICKNAME]</a>
    
    <a style="margin-bottom: 5px;" value="[USER_EMAIL]" class="quick-shortcode-button button-secondary wp_custom_admin_interface_append_buttons_'.$class.'">[USER_EMAIL]</a>
    
    ';
    
}
/**
* 
*
*
* Function to add new dashboard widget
*/
function wp_custom_admin_interface_dashboard_widget() {
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    if(isset($options['wp_custom_admin_interface_enable_custom_widget'])) {
        
        if(strlen($options['wp_custom_admin_interface_custom_widget_title'])<1) {
            $widgetTitle = "Custom Widget";      
        } else {
            $widgetTitle = $options['wp_custom_admin_interface_custom_widget_title'];       
        }
        
        wp_add_dashboard_widget(
            'custom_widget',         // Widget slug.
            $widgetTitle,         // Title.
            'custom_widget_output' // Display function.
        );

        function custom_widget_output() {
            $options = get_option( 'wp_custom_admin_interface_settings' );
            echo wp_custom_admin_interface_shortcode_replacer($options['wp_custom_admin_interface_custom_widget_content']); 
        }
    }
}
add_action( 'wp_dashboard_setup', 'wp_custom_admin_interface_dashboard_widget' );
/**
* 
*
*
* Function to run PHP code
*/
function wp_custom_admin_interface_run_php() {
$options = get_option( 'wp_custom_admin_interface_settings' );
    if(isset($options['wp_custom_admin_interface_deactivate_code'])){} else {
        if(isset($options['wp_custom_admin_interface_custom_php_code'])){

            $content = $options['wp_custom_admin_interface_custom_php_code']; 
            
            $stripPhpTags = preg_replace('/^<\?php(.*)(\?>)?$/s', '$1', $content);
            
            ob_start();
            @eval($stripPhpTags);   
            ob_end_clean();
        }
    }
}
wp_custom_admin_interface_run_php();
/**
* 
*
*
* Function to add new dashboard widget
*/
function wp_custom_admin_interface_custom_favicon() {
    
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    if(isset($options['wp_custom_admin_interface_custom_favicon']) && strlen($options['wp_custom_admin_interface_custom_favicon'])>0){
        echo '<link rel="shortcut icon" href="' . $options['wp_custom_admin_interface_custom_favicon'] . '" />';    
    } else {
        
        return;
    }  
    
}
add_action('login_head', 'wp_custom_admin_interface_custom_favicon');
add_action('admin_head', 'wp_custom_admin_interface_custom_favicon');
if(isset($options['wp_custom_admin_interface_custom_favicon_frontend'])){
    add_action('wp_head','wp_custom_admin_interface_custom_favicon'); 
}
/**
* 
*
*
* Function to add custom colour scheme
*/
function wp_custom_admin_interface_custom_color_scheme() {

    $options = get_option( 'wp_custom_admin_interface_settings' );    

    if(isset($options['wp_custom_admin_interface_color_scheme_icon_color'])){
        $svgIconColor = $options['wp_custom_admin_interface_color_scheme_icon_color'];
    } else {
        $svgIconColor = "#f1f2f3"; 
    }    


    if(isset($options['wp_custom_admin_interface_color_scheme_color_one']) && isset($options['wp_custom_admin_interface_color_scheme_color_two']) && isset($options['wp_custom_admin_interface_color_scheme_color_three']) && isset($options['wp_custom_admin_interface_color_scheme_color_four'])){
        $colorScheme = array( $options['wp_custom_admin_interface_color_scheme_color_one'], $options['wp_custom_admin_interface_color_scheme_color_two'], $options['wp_custom_admin_interface_color_scheme_color_three'], $options['wp_custom_admin_interface_color_scheme_color_four'] );   
    } else {
        $colorScheme = array( '#222', '#333', '#0073aa', '#00a0d2' );
    }    
       
    wp_admin_css_color(
    'custom', 
    'Custom',
    plugins_url( '/inc/admintheme.css', __FILE__ ),
    $colorScheme,
    array( 'base' => $svgIconColor, 'focus' => $svgIconColor, 'current' => $svgIconColor )
    );
        
}
add_action('admin_init', 'wp_custom_admin_interface_custom_color_scheme');
/**
* 
*
*
* Function to implement custom color scheme to head
*/
function wp_custom_admin_interface_custom_color_scheme_implementation()
{
    
    wp_enqueue_style( 'custom-admin-theme', plugins_url( '/inc/admintheme.css', __FILE__ ) );
    
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    $currentColorScheme = get_user_option( 'admin_color' );
    
    if($currentColorScheme == "custom" && isset($options['wp_custom_admin_interface_color_scheme_color_one']) && isset($options['wp_custom_admin_interface_color_scheme_color_two']) && isset($options['wp_custom_admin_interface_color_scheme_color_three']) && isset($options['wp_custom_admin_interface_color_scheme_color_four']) && isset($options['wp_custom_admin_interface_color_scheme_icon_color'])){
    
    $customColorOne = $options['wp_custom_admin_interface_color_scheme_color_one']." !important"; 
    $customColorTwo = $options['wp_custom_admin_interface_color_scheme_color_two']." !important";   
    $customColorThree = $options['wp_custom_admin_interface_color_scheme_color_three']." !important";
    $customColorFour = $options['wp_custom_admin_interface_color_scheme_color_four']." !important";
    $customIconColor = $options['wp_custom_admin_interface_color_scheme_icon_color']." !important";   
    
            
        
    $cssWithVariables = "
    
    #adminmenu li a.wp-has-current-submenu .update-plugins,
    #adminmenu li.current a .awaiting-mod,
    #adminmenu li.menu-top:hover>a .update-plugins,
    #adminmenu li:hover a .awaiting-mod {
        background: {$customColorFour};
    }
    #adminmenu .wp-has-current-submenu .wp-submenu,
    #adminmenu .wp-has-current-submenu.opensub .wp-submenu,
    #adminmenu .wp-submenu,
    #adminmenu a.wp-has-current-submenu:focus+.wp-submenu,
    .folded #adminmenu .wp-has-current-submenu .wp-submenu {
        background: {$customColorOne};
    }

    #adminmenu li.wp-has-submenu.wp-not-current-submenu.opensub:hover:after {
        border-right-color: {$customColorOne};
    }

    #wpadminbar .ab-top-menu>li.menupop.hover>.ab-item,
    #wpadminbar.nojq .quicklinks .ab-top-menu>li>.ab-item:focus,
    #wpadminbar.nojs .ab-top-menu>li.menupop:hover>.ab-item,
    #wpadminbar:not(.mobile) .ab-top-menu>li:hover>.ab-item,
    #wpadminbar:not(.mobile) .ab-top-menu>li>.ab-item:focus {
        background: {$customColorOne};
    }

    #wpadminbar .menupop .ab-sub-wrapper {
        background: {$customColorOne};
    }

    .wp-responsive-open #wpadminbar #wp-admin-bar-menu-toggle a {
        background: {$customColorOne};
    }







    input[type=checkbox]:checked:before {
        color: {$customColorTwo};
    }

    input[type=radio]:checked:before {
        background: {$customColorTwo};
    } 

    .wp-core-ui .wp-ui-primary {
        background-color: {$customColorTwo};
    }

    .wp-core-ui .wp-ui-text-primary {
        color: {$customColorTwo};
    }

    .tablenav .tablenav-pages a:focus,
    .tablenav .tablenav-pages a:hover,
    .wrap .add-new-h2:hover,
    .wrap .page-title-action:hover {
        background-color: {$customColorTwo};
    }

    .view-switch a.current:before {
        color: {$customColorTwo};
    }

    #adminmenu,
    #adminmenuback,
    #adminmenuwrap {
        background: {$customColorTwo};
    }

    #wpadminbar {
        background: {$customColorTwo};
    }

    .theme-filter.current,
    .theme-section.current {
        border-bottom-color: {$customColorTwo};
    }

    body.more-filters-opened .more-filters {
        background-color: {$customColorTwo};
    }






    .wp-core-ui .wp-ui-highlight {
        background-color: {$customColorThree};
    }

    .wp-core-ui .wp-ui-text-highlight {
        color: {$customColorThree};
    }

    #adminmenu a:hover,
    #adminmenu li.menu-top:hover,
    #adminmenu li.opensub>a.menu-top,
    #adminmenu li>a.menu-top:focus {
        background-color: {$customColorThree};
    }

    #adminmenu .wp-has-current-submenu .wp-submenu a:focus,
    #adminmenu .wp-has-current-submenu .wp-submenu a:hover,
    #adminmenu .wp-has-current-submenu.opensub .wp-submenu a:focus,
    #adminmenu .wp-has-current-submenu.opensub .wp-submenu a:hover,
    #adminmenu .wp-submenu a:focus,
    #adminmenu .wp-submenu a:hover,
    #adminmenu a.wp-has-current-submenu:focus+.wp-submenu a:focus,
    #adminmenu a.wp-has-current-submenu:focus+.wp-submenu a:hover,
    .folded #adminmenu .wp-has-current-submenu .wp-submenu a:focus,
    .folded #adminmenu .wp-has-current-submenu .wp-submenu a:hover {
        color: white;
    }


    #adminmenu .wp-has-current-submenu.opensub .wp-submenu li.current a:focus,
    #adminmenu .wp-has-current-submenu.opensub .wp-submenu li.current a:hover,
    #adminmenu .wp-submenu li.current a:focus,
    #adminmenu .wp-submenu li.current a:hover,
    #adminmenu a.wp-has-current-submenu:focus+.wp-submenu li.current a:focus,
    #adminmenu a.wp-has-current-submenu:focus+.wp-submenu li.current a:hover {
        color: white;
    }

    #adminmenu li.current a.menu-top,
    #adminmenu li.wp-has-current-submenu .wp-submenu .wp-submenu-head,
    #adminmenu li.wp-has-current-submenu a.wp-has-current-submenu,
    .folded #adminmenu li.current.menu-top {
        background: {$customColorThree};
    }

    #collapse-button:focus,
    #collapse-button:hover {
        color: {$customColorThree};
    }



    #wpadminbar .ab-top-menu>li.menupop.hover>.ab-item,
    #wpadminbar.nojq .quicklinks .ab-top-menu>li>.ab-item:focus,
    #wpadminbar.nojs .ab-top-menu>li.menupop:hover>.ab-item,
    #wpadminbar:not(.mobile) .ab-top-menu>li:hover>.ab-item,
    #wpadminbar:not(.mobile) .ab-top-menu>li>.ab-item:focus {
        color: {$customColorThree};
    }

    #wpadminbar:not(.mobile)>#wp-toolbar a:focus span.ab-label,
    #wpadminbar:not(.mobile)>#wp-toolbar li.hover span.ab-label,
    #wpadminbar:not(.mobile)>#wp-toolbar li:hover span.ab-label {
        color: {$customColorThree};
    }

    #wpadminbar .quicklinks .ab-sub-wrapper .menupop.hover>a,
    #wpadminbar .quicklinks .menupop ul li a:focus,
    #wpadminbar .quicklinks .menupop ul li a:focus strong,
    #wpadminbar .quicklinks .menupop ul li a:hover,
    #wpadminbar .quicklinks .menupop ul li a:hover strong,
    #wpadminbar .quicklinks .menupop.hover ul li a:focus,
    #wpadminbar .quicklinks .menupop.hover ul li a:hover,
    #wpadminbar li #adminbarsearch.adminbar-focused:before,
    #wpadminbar li .ab-item:focus .ab-icon:before,
    #wpadminbar li .ab-item:focus:before,
    #wpadminbar li a:focus .ab-icon:before,
    #wpadminbar li.hover .ab-icon:before,
    #wpadminbar li.hover .ab-item:before,
    #wpadminbar li:hover #adminbarsearch:before,
    #wpadminbar li:hover .ab-icon:before,
    #wpadminbar li:hover .ab-item:before,
    #wpadminbar.nojs .quicklinks .menupop:hover ul li a:focus,
    #wpadminbar.nojs .quicklinks .menupop:hover ul li a:hover {
        color: {$customColorThree};
    }

    #wpadminbar .menupop .menupop>.ab-item:hover:before,
    #wpadminbar .quicklinks .ab-sub-wrapper .menupop.hover>a .blavatar,
    #wpadminbar .quicklinks li a:focus .blavatar,
    #wpadminbar .quicklinks li a:hover .blavatar,
    #wpadminbar.mobile .quicklinks .ab-icon:before,
    #wpadminbar.mobile .quicklinks .ab-item:before {
        color: {$customColorThree};
    }    

    #wpadminbar #wp-admin-bar-user-info a:hover .display-name {
        color: {$customColorThree};
    }

    .wp-pointer .wp-pointer-content h3 {
        background-color: {$customColorThree};
    }

    .wp-pointer .wp-pointer-content h3:before {
        color: {$customColorThree};
    }



    .wp-pointer.wp-pointer-top .wp-pointer-arrow,
    .wp-pointer.wp-pointer-top .wp-pointer-arrow-inner,
    .wp-pointer.wp-pointer-undefined .wp-pointer-arrow,
    .wp-pointer.wp-pointer-undefined .wp-pointer-arrow-inner {
        border-bottom-color: {$customColorThree};
    }

    .media-item .bar,
    .media-progress-bar div {
        background-color: {$customColorThree};
    }

    .details.attachment {
        -webkit-box-shadow: inset 0 0 0 3px #fff, inset 0 0 0 7px {$customColorThree};
        box-shadow: inset 0 0 0 3px #fff, inset 0 0 0 7px {$customColorThree};
    }

    .attachment.details .check {
        background-color: {$customColorThree};
        -webkit-box-shadow: 0 0 0 1px #fff, 0 0 0 2px {$customColorThree};
        box-shadow: 0 0 0 1px #fff, 0 0 0 2px {$customColorThree};
    }

    .media-selection .attachment.selection.details .thumbnail {
        -webkit-box-shadow: 0 0 0 1px #fff, 0 0 0 3px {$customColorThree};
        box-shadow: 0 0 0 1px #fff, 0 0 0 3px {$customColorThree};
    }

    .theme-browser .theme.active .theme-name,
    .theme-browser .theme.add-new-theme a:focus:after,
    .theme-browser .theme.add-new-theme a:hover:after {
        background: {$customColorThree};
    }

    .theme-browser .theme.add-new-theme a:focus span:after,
    .theme-browser .theme.add-new-theme a:hover span:after {
        color: {$customColorThree};
    }

    body.more-filters-opened .more-filters:focus,
    body.more-filters-opened .more-filters:hover {
        background-color: {$customColorThree};
    }

    .widgets-chooser li.widgets-chooser-selected {
        background-color: {$customColorThree};
    }

    .wp-responsive-open div#wp-responsive-toggle a {
        background: {$customColorThree};
    }

    .mce-container.mce-menu .mce-menu-item-normal.mce-active,
    .mce-container.mce-menu .mce-menu-item-preview.mce-active,
    .mce-container.mce-menu .mce-menu-item.mce-selected,
    .mce-container.mce-menu .mce-menu-item:focus,
    .mce-container.mce-menu .mce-menu-item:hover {
        background: {$customColorThree};
    }

    .wp-core-ui .wp-ui-notification {
        background-color: {$customColorFour};
    }

    .wp-core-ui .wp-ui-text-notification {
        color: {$customColorFour};
    }    

    .view-switch a:hover:before {
        color: {$customColorFour};
    }

    #adminmenu .awaiting-mod,
    #adminmenu .update-plugins {
        background: {$customColorFour};
    }

    #adminmenu a:hover, #adminmenu li.menu-top:hover, #adminmenu li.opensub>a.menu-top, #adminmenu li>a.menu-top:focus {
    color: #fff;
    }

    .wp-menu-image, .wp-menu-image:before {
        color: {$customIconColor};     
    }
    
    .wp-admin #wpadminbar #wp-admin-bar-site-name>.ab-item:before {
    color: {$customIconColor};
    }

    ";
    
    wp_add_inline_style( 'custom-admin-theme', $cssWithVariables );     
        
    }
    
    
}
add_action( 'admin_enqueue_scripts', 'wp_custom_admin_interface_custom_color_scheme_implementation' );
/**
* 
*
*
* Function to force color scheme if desired
*/
function wp_custom_admin_interface_force_color_scheme($color_scheme)
{
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    if(isset($options['wp_custom_admin_interface_force_color_scheme'])){
        $color_scheme = 'custom';    
        return $color_scheme;
    } else {
        return $color_scheme;      
    }
      
}
add_filter( 'get_user_option_admin_color', 'wp_custom_admin_interface_force_color_scheme', 5 );
/**
* 
*
*
* Function to disable automatic updates
*/
function wp_custom_admin_interface_disable_automatic_updates()
{
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    if(isset($options['wp_custom_admin_interface_disable_update'])){
        add_filter( 'automatic_updater_disabled', '__return_true' );      
    }
    
}
wp_custom_admin_interface_disable_automatic_updates();
/**
* 
*
*
* Function to check whether the current user should be subjected to the custom admin menu
*/
function wp_custom_admin_interface_admin_menu_exception_check($transientDefiner,$exceptionType,$exceptionCases)
{
    $options = get_option( 'wp_custom_admin_interface_settings' );
    

    //current user
    $currentUser = wp_get_current_user();
    //current user ID
    $currentUserId = $currentUser->ID;   
    //create transient name    
    $transientName = 'wpcai_'.$transientDefiner.'_'.$currentUserId;
    //get transient
    $getTransient = get_transient($transientName);   

    //if transient exists return this value otherwise do the check and create the transient
    if($getTransient != false){

        return $getTransient;

    } else {

        //get current user role    
        $currentUserRole = strtoupper($currentUser->roles[0]); 
        
        $removeLastCharacterFromexceptionCases = substr($exceptionCases,0,-1);
        //create an array from exception cases
        $exceptionCasesArray = explode(",",$removeLastCharacterFromexceptionCases); 

        //start running through the exception rules    
        if($exceptionType == "Everyone"){
            //here we are taking them away
            $score = 1;  
            foreach($exceptionCasesArray as $value){

                //now we need to check whether the value is an integer
                if(is_numeric($value)) {
                    //so the value is an integer which means we need to check against the user id    
                    if($value == $currentUserId){
                        $score--;      
                    }
                } else {
                    //so the value isn't an integer which means we need to check against the user role
                    $valueUpper = strtoupper($value);

                    if($valueUpper == $currentUserRole){
                        $score--;      
                    } 
                }
            }  


        } else {
            //here we are adding values
            $score = 0;
            foreach($exceptionCasesArray as $value){

                //now we need to check whether the value is an integer
                if(is_numeric($value)) {
                    //so the value is an integer which means we need to check against the user id    
                    if($value == $currentUserId){
                        $score++;      
                    }
                } else {
                    //so the value isn't an integer which means we need to check against the user role
                    $valueUpper = strtoupper($value);

                    if($valueUpper == $currentUserRole){
                        $score++;      
                    } 
                }
            }

        } 

        if($score < 1){
            //the menu wouldn't show for you
            //set transient and return value
            set_transient($transientName,false,0);
            return false;    
        } else {
            //the menu would show for you
            //set transient and return value
            set_transient($transientName,true,0);
            return true;     
        }    
    }

              
}
/**
* 
*
*
* Function to make changes to the admin menu
*/
function wp_custom_admin_interface_implement_custom_admin_menu()
{
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    
    global $submenu, $menu;
    global $wp_custom_admin_interface_original_top_level_menu, $wp_custom_admin_interface_original_sub_level_menu;

    $wp_custom_admin_interface_original_top_level_menu = $menu;
    $wp_custom_admin_interface_original_sub_level_menu = $submenu;

    //sort values and remove the links
    ksort($wp_custom_admin_interface_original_top_level_menu, SORT_NUMERIC);
    foreach ($wp_custom_admin_interface_original_top_level_menu as $key => $value){
        unset($wp_custom_admin_interface_original_top_level_menu[15]);

    }

    //rename all the keys because javascript doesn't like strings as key
    $wp_custom_admin_interface_original_top_level_menu = array_values($wp_custom_admin_interface_original_top_level_menu);

    
    if(isset($options['wp_custom_admin_interface_remove_menu_item'])) {

            
        //lets check if the changes are going to apply to this user
        
        if(wp_custom_admin_interface_admin_menu_exception_check('menu',$options['wp_custom_admin_interface_exception_type'],$options['wp_custom_admin_interface_exception_cases'])) {
            
            //lets replace the standard menu with our custom menu
            
            $topLevelMenu = $options['wp_custom_admin_interface_top_level_menu'];

            $subLevelMenu = $options['wp_custom_admin_interface_sub_level_menu'];

            $topLevelMenuDecoded = json_decode(base64_decode($topLevelMenu),true);

            $subLevelMenuDecoded = json_decode(base64_decode($subLevelMenu), true); 
            
            
            

            
            
            //check if notifications are necessary on the custom menu
            if(isset($options['wp_custom_admin_interface_show_notifications'])){
            
                //create an array which will store all our notifications
                $itemsWithNotifications = array();

                //cycle through the top level menu
                foreach($menu as $item => $value) {
                    //check if the label has a notification and if it does carry on
                    if(strpos($value[0], '<span') !== false) {
                        $positionOfSpan = strpos($value[0],'<span');
                        $lengthOfNotification = strlen($value[0])-$positionOfSpan;
                        $justTheNotification = substr($value[0],$positionOfSpan,$lengthOfNotification);
                        //add the position and notification to the array
                        $itemsWithNotifications += array($value[2] => $justTheNotification);     
                    }
                }

                //cycle through the sub level menu
                foreach($submenu as $item => $value){
                    //let's go a little deeper
                    foreach($value as $item => $value){
                        //check if the label has a notification and if it does carry on
                        if(strpos($value[0], '<span') !== false) {
                            $positionOfSpan = strpos($value[0],'<span');
                            $lengthOfNotification = strlen($value[0])-$positionOfSpan;
                            $justTheNotification = substr($value[0],$positionOfSpan,$lengthOfNotification);
                            //add the position and notification to the array
                            $itemsWithNotifications += array($value[2] => $justTheNotification);     
                        }
                    }
                }    
                
                
                
                //now lets loop through our new menu and add these notifications to it
                //let's start with the top level menu
                foreach($topLevelMenuDecoded as $item => $value) {
                    
                    $menuLink = $value[2];
                    
                    if(array_key_exists($menuLink,$itemsWithNotifications)){
                        
                        $notificationToUtilise = $itemsWithNotifications[$menuLink];
                        
                        $topLevelMenuDecoded[$item][0] = $value[0].' '.$notificationToUtilise;
                        
                    } 
                }
                

                //and now the sub menu
                foreach($subLevelMenuDecoded as $item => $value) {
                    //let's go a little deeper
                    foreach($value as $itemDeeper => $valueDeeper){   
                    
                        $menuLink = $valueDeeper[2];

                        if(array_key_exists($menuLink,$itemsWithNotifications)){

                            $notificationToUtilise = $itemsWithNotifications[$menuLink];

                            $subLevelMenuDecoded[$item][$itemDeeper][0] = $valueDeeper[0].' '.$notificationToUtilise;
                            
                        } 
                    }
                }
            }
 
            
            
            $menu = $topLevelMenuDecoded;
            $submenu = $subLevelMenuDecoded;    
            
            
            //now lets remove menu pages

            $removeLastCharacterFromString = substr($options['wp_custom_admin_interface_remove_menu_item'],0,-1);

            $turnCommaStringIntoArray = explode(",", $removeLastCharacterFromString);

            //cycle through each item in array
            foreach ($turnCommaStringIntoArray as $value) {

                //now we need to check whether the value has square brackets - this will determine whether the item is a top level or sub level item
                if(strpos($value, '[') !== false) {

                //lets get the top level component part    
                $positionOfFirstSquareBracket = strpos($value,'[');
                $topLevelMenuComponent = substr($value,0,$positionOfFirstSquareBracket);  

                //lets ge the sub level component part
                preg_match("/\[(.*)\]/", $value , $matches); 
                $subLevelMenuComponent = $matches[1];   

                remove_submenu_page($topLevelMenuComponent,$subLevelMenuComponent);    


                } else {
                    //its a top level menu item so lets remove it
                    remove_menu_page($value);   
                }  
            }
        }
    } 
}
//note this priority number needs to be set low otherwise custom plugins will run after so their menu items could render 2 times
add_action( 'admin_menu', 'wp_custom_admin_interface_implement_custom_admin_menu',999);
/**
* 
*
*
* Function to delete the menu upon request
*/
function wp_custom_admin_interface_delete_menu($wp) {
    // only process requests with "wp-custom-admin-interface=delete-menu"
    if (array_key_exists('wp-custom-admin-interface', $wp->query_vars) 
            && $wp->query_vars['wp-custom-admin-interface'] == 'delete-menu') {
        
        
        // check if user can manage options    
        if ( ! current_user_can( 'manage_options') ){
            echo "You don't have permission to perform this action.";
            die(); 
        } 
        
        
        //first we need to get our options
        $options = get_option( 'wp_custom_admin_interface_settings' );
        
        //we then need to loop through the options and update the value the menu settings with null
        
        $options['wp_custom_admin_interface_top_level_menu'] = null;
        $options['wp_custom_admin_interface_sub_level_menu'] = null;
        $options['wp_custom_admin_interface_remove_menu_item'] = null;
        $options['wp_custom_admin_interface_exception_type'] = null;
        $options['wp_custom_admin_interface_exception_cases'] = null;
        
 
        //then we need to update the setting with our new array
        update_option('wp_custom_admin_interface_settings',$options);
        
        
        wp_die('The custom admin menu has now been deleted.');
    }
}
add_action('parse_request', 'wp_custom_admin_interface_delete_menu');
/**
* 
*
*
* Function to create the query for the above function
*/
function wp_custom_admin_interface_query_vars($vars) {
    $vars[] = 'wp-custom-admin-interface';
    return $vars;
}
add_filter('query_vars', 'wp_custom_admin_interface_query_vars');
/**
* 
*
*
* Function to clear transients, this is fired when someone saves the settings.
*/
function wp_custom_admin_interface_delete_transients() {
	global $wpdb; 
    $sql = "DELETE FROM {$wpdb->options} WHERE option_name LIKE '_transient_wpcai_%'";
    $wpdb->query($sql);
    echo "success";    
    die();    
}
add_action( 'wp_ajax_delete_transients', 'wp_custom_admin_interface_delete_transients');
/**
* 
*
*
* Add translation
*/
add_action('plugins_loaded', 'wp_custom_admin_interface_translations');
function wp_custom_admin_interface_translations() {
	load_plugin_textdomain( 'wp-custom-admin-interface', false, dirname( plugin_basename(__FILE__) ) . '/inc/lang/' );
}
/**
* 
*
*
* Remove plugins from plugin page
*/
function wp_custom_admin_hide_plugins() {
    global $wp_list_table;
    
    $options = get_option( 'wp_custom_admin_interface_settings' );    

    
    $removedPlugins = $options['wp_custom_admin_interface_hide_these_plugins'];
    
    //check if the setting is set
    if(isset($removedPlugins)){

        //lets check if the changes are going to apply to this user
        if(wp_custom_admin_interface_admin_menu_exception_check('plugin',$options['wp_custom_admin_interface_exception_type_plugin'],$options['wp_custom_admin_interface_exception_cases_plugin'])) {

            $removeFirstCharacterFromRemovedPlugins = substr($removedPlugins,1);
            //create an array from exception cases
            $removedPluginsArray = explode(",",$removeFirstCharacterFromRemovedPlugins); 

            $myplugins = $wp_list_table->items;

            foreach ($myplugins as $key => $val) {
                if (in_array($key,$removedPluginsArray)) {
                unset($wp_list_table->items[$key]);
                }
            }    
        }
    }
    

}
add_action('pre_current_active_plugins', 'wp_custom_admin_hide_plugins');
/**
* 
*
*
* Function to assist in the rendering of exception types
*/
function wp_custom_admin_interface_exception_type_render_assist($existingExceptionTypeOption) { 
    
	$options = get_option( 'wp_custom_admin_interface_settings' );          
    
    $html = '<tr class="userAndRoleSelection" valign="top"><td scope="row" colspan="2"><h3 style="margin-top: -5px; margin-bottom:0px;">';
    $html .= __('Implement this for', 'wp-custom-admin-interface' );
    
    if(isset($options[$existingExceptionTypeOption])) {
        $wp_custom_admin_interface_exception_type = $options[$existingExceptionTypeOption];
    } else {
        $wp_custom_admin_interface_exception_type = "No-one";
    } 
    
    $html .= ' <select name="wp_custom_admin_interface_settings[';
    $html .= $existingExceptionTypeOption;
    $html .= ']" id="';
    $html .= $existingExceptionTypeOption;
    $html .= '">'; 
    $html .= '<option value="No-one" ';
    
 
    if( 'No-one'== $wp_custom_admin_interface_exception_type) {
    $html .= 'selected="selected"'; 
    }
    $html .= '>';
    $html .= __('No-one', 'wp-custom-admin-interface' ); 
    $html .= '</option>';
    $html .= '<option value="Everyone" ';

    if( 'Everyone'==$wp_custom_admin_interface_exception_type) {
        $html.= 'selected="selected"'; 
    }
    $html .= '>';
    $html .= __('Everyone', 'wp-custom-admin-interface' );
    $html .= '</option></select> ';
    $html .= __('except', 'wp-custom-admin-interface' );
    $html .= '</h3></td></tr>';
    

               
    return $html;
}
/**
* 
*
*
* Function to assist in the rendering of exception cases
*/
function wp_custom_admin_interface_exception_cases_render_assist($existingExceptionCases) { 
    
    
    $options = get_option( 'wp_custom_admin_interface_settings' );
    
    $html = '<tr valign="top"><td scope="row" colspan="2">';
    
    
    $outputOfUsersAndRolesSelection = '';
    //lets get the users
    $users = get_users( array( 'fields' => array( 'ID' ) ) );
    foreach($users as $user_id){

        $userID = $user_id->ID;
        $firstName = get_user_meta($user_id->ID, 'first_name', true);
        $lastName = get_user_meta($user_id->ID, 'last_name', true);

        $outputOfUsersAndRolesSelection .= 'User: '.$firstName.' '.$lastName.'('.$userID.'),';

    }

    //lets get the roles
    global $wp_roles;
    foreach ( $wp_roles->roles as $key=>$value ){
        $outputOfUsersAndRolesSelection .= 'Role: '.$value['name'].',';    
    }
            
    $html .= '<div id="combinedListOfUsersAndRoles" data="';        
    $html .= $outputOfUsersAndRolesSelection;
    $html .= '"></div><div id="outputOfUsersAndRolesSelection" data=""></div><input style="display:none;" class="wp_custom_admin_interface_settings_input saved_exception_cases" type="text" name="wp_custom_admin_interface_settings[';

    $html .= $existingExceptionCases;        
    
    $html .= ']" id="';
    
    $html .= $existingExceptionCases; 

    $html .= '" class="regular-text" value="';

    if(isset($options[$existingExceptionCases])) { 
        
        $html .= esc_attr($options[$existingExceptionCases]); 
    
    } 
    
      
     $html .= '"></td></tr>';       

    return $html;

}
/**
* 
*
*
* Remove users from user page
*/
function wp_custom_admin_interface_hide_users($user_search) {
    
    $options = get_option( 'wp_custom_admin_interface_settings' );    

    $removedUsers = $options['wp_custom_admin_interface_hide_these_users'];
    
    
    global $wp_custom_admin_interface_original_user_listing; 
    
    global $wpdb;

    
    $sql = "
    SELECT {$wpdb->users}.ID, firstname.meta_value as first_name, lastname.meta_value as last_name, devcapabilities.meta_value as dev_capabilities
    FROM {$wpdb->users} 
    INNER JOIN (SELECT user_id, meta_value FROM {$wpdb->usermeta} WHERE meta_key = 'first_name') as firstname ON {$wpdb->users}.ID = firstname.user_id
    INNER JOIN (SELECT user_id, meta_value FROM {$wpdb->usermeta} WHERE meta_key = 'last_name') as lastname ON {$wpdb->users}.ID = lastname.user_id
    INNER JOIN (SELECT user_id, meta_value FROM {$wpdb->usermeta} WHERE meta_key = 'dev_capabilities') as devcapabilities ON {$wpdb->users}.ID = devcapabilities.user_id
    ";
    

    $users = $wpdb->get_results($sql);

    $wp_custom_admin_interface_original_user_listing = $users;
    
    

    //check if the setting is set
    if(isset($removedUsers)){

        //lets check if the changes are going to apply to this user
        if(wp_custom_admin_interface_admin_menu_exception_check('user',$options['wp_custom_admin_interface_exception_type_user'],$options['wp_custom_admin_interface_exception_cases_user'])) {

            //gel global variable    
            global $current_user;
            //get current user login    
            $userID = $current_user->ID;



            $removeFirstCharacterFromRemovedUsers = substr($removedUsers,1);
            //create an array from exception cases
            $removedUsersArray = explode(",",$removeFirstCharacterFromRemovedUsers);     

            //get the database    
            global $wpdb;

            foreach ($removedUsersArray as &$removedUser) {

                //if the current user is the user lets not remove them, so this way they can still see themselves
                if ($userID == $removedUser) { 

                } else {
                    //do query
                    $user_search->query_where = str_replace('WHERE 1=1',"WHERE 1=1 AND {$wpdb->users}.ID != '$removedUser'",$user_search->query_where);    
                }       

            }  
 
        }
    }
    

}
add_action('pre_user_query', 'wp_custom_admin_interface_hide_users');
/**
* 
*
*
* Remove sidebars from widget page
*/
function wp_custom_admin_interface_hide_sidebars() {
    
    $options = get_option( 'wp_custom_admin_interface_settings' );    
    
    global $wp_registered_sidebars;
    global $wp_custom_admin_interface_original_sidebar_listing; 
    
    $wp_custom_admin_interface_original_sidebar_listing = $wp_registered_sidebars;
    
    
    $removedSidebars = $options['wp_custom_admin_interface_hide_these_sidebars'];
    
    

    //check if the setting is set
    if(isset($removedSidebars)){

        //lets check if the changes are going to apply to this user
        if(wp_custom_admin_interface_admin_menu_exception_check('sidebar',$options['wp_custom_admin_interface_exception_type_sidebar'],$options['wp_custom_admin_interface_exception_cases_sidebar'])) {
            
            //remove first character from string
            $removeFirstCharacterFromRemovedSidebars = substr($removedSidebars,1);
            //create an array from exception cases
            $removedSidebarsArray = explode(",",$removeFirstCharacterFromRemovedSidebars);     

            foreach ($removedSidebarsArray as &$removedSidebar) {
            
                unregister_sidebar($removedSidebar);
            
            }
        }
    }

}
add_action('admin_init', 'wp_custom_admin_interface_hide_sidebars');






















/*
function get_admin_bar_header_array($admin_bar){
    
    echo '<div style="float: right;">';  
    highlight_string("<?php\n\$data =\n" . var_export($admin_bar, true) . ";\n?>");
    echo '</div>';  

}
add_action('admin_bar_menu', 'get_admin_bar_header_array', PHP_INT_MAX);
*/
?>